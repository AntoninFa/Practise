<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>11 Asynchrone Methoden und Parallelit&auml;t</title>
        <style>
/* From extension vscode.markdown-math */
@font-face{font-family:KaTeX_AMS;src:url(fonts/KaTeX_AMS-Regular.woff2) format("woff2"),url(fonts/KaTeX_AMS-Regular.woff) format("woff"),url(fonts/KaTeX_AMS-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Caligraphic;src:url(fonts/KaTeX_Caligraphic-Bold.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Bold.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:KaTeX_Caligraphic;src:url(fonts/KaTeX_Caligraphic-Regular.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Regular.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Fraktur;src:url(fonts/KaTeX_Fraktur-Bold.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Bold.woff) format("woff"),url(fonts/KaTeX_Fraktur-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:KaTeX_Fraktur;src:url(fonts/KaTeX_Fraktur-Regular.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Regular.woff) format("woff"),url(fonts/KaTeX_Fraktur-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Main;src:url(fonts/KaTeX_Main-Bold.woff2) format("woff2"),url(fonts/KaTeX_Main-Bold.woff) format("woff"),url(fonts/KaTeX_Main-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:KaTeX_Main;src:url(fonts/KaTeX_Main-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Main-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Main-BoldItalic.ttf) format("truetype");font-weight:700;font-style:italic}@font-face{font-family:KaTeX_Main;src:url(fonts/KaTeX_Main-Italic.woff2) format("woff2"),url(fonts/KaTeX_Main-Italic.woff) format("woff"),url(fonts/KaTeX_Main-Italic.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:KaTeX_Main;src:url(fonts/KaTeX_Main-Regular.woff2) format("woff2"),url(fonts/KaTeX_Main-Regular.woff) format("woff"),url(fonts/KaTeX_Main-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Math;src:url(fonts/KaTeX_Math-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Math-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Math-BoldItalic.ttf) format("truetype");font-weight:700;font-style:italic}@font-face{font-family:KaTeX_Math;src:url(fonts/KaTeX_Math-Italic.woff2) format("woff2"),url(fonts/KaTeX_Math-Italic.woff) format("woff"),url(fonts/KaTeX_Math-Italic.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:"KaTeX_SansSerif";src:url(fonts/KaTeX_SansSerif-Bold.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Bold.woff) format("woff"),url(fonts/KaTeX_SansSerif-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:"KaTeX_SansSerif";src:url(fonts/KaTeX_SansSerif-Italic.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Italic.woff) format("woff"),url(fonts/KaTeX_SansSerif-Italic.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:"KaTeX_SansSerif";src:url(fonts/KaTeX_SansSerif-Regular.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Regular.woff) format("woff"),url(fonts/KaTeX_SansSerif-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Script;src:url(fonts/KaTeX_Script-Regular.woff2) format("woff2"),url(fonts/KaTeX_Script-Regular.woff) format("woff"),url(fonts/KaTeX_Script-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size1;src:url(fonts/KaTeX_Size1-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size1-Regular.woff) format("woff"),url(fonts/KaTeX_Size1-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size2;src:url(fonts/KaTeX_Size2-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size2-Regular.woff) format("woff"),url(fonts/KaTeX_Size2-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size3;src:url(fonts/KaTeX_Size3-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size3-Regular.woff) format("woff"),url(fonts/KaTeX_Size3-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size4;src:url(fonts/KaTeX_Size4-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size4-Regular.woff) format("woff"),url(fonts/KaTeX_Size4-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Typewriter;src:url(fonts/KaTeX_Typewriter-Regular.woff2) format("woff2"),url(fonts/KaTeX_Typewriter-Regular.woff) format("woff"),url(fonts/KaTeX_Typewriter-Regular.ttf) format("truetype");font-weight:400;font-style:normal}.katex{font:normal 1.21em KaTeX_Main,Times New Roman,serif;line-height:1.2;text-indent:0;text-rendering:auto;border-color:currentColor}.katex *{-ms-high-contrast-adjust:none!important}.katex .katex-version:after{content:"0.13.0"}.katex .katex-mathml{position:absolute;clip:rect(1px,1px,1px,1px);padding:0;border:0;height:1px;width:1px;overflow:hidden}.katex .katex-html>.newline{display:block}.katex .base{position:relative;white-space:nowrap;width:-webkit-min-content;width:-moz-min-content;width:min-content}.katex .base,.katex .strut{display:inline-block}.katex .textbf{font-weight:700}.katex .textit{font-style:italic}.katex .textrm{font-family:KaTeX_Main}.katex .textsf{font-family:KaTeX_SansSerif}.katex .texttt{font-family:KaTeX_Typewriter}.katex .mathnormal{font-family:KaTeX_Math;font-style:italic}.katex .mathit{font-family:KaTeX_Main;font-style:italic}.katex .mathrm{font-style:normal}.katex .mathbf{font-family:KaTeX_Main;font-weight:700}.katex .boldsymbol{font-family:KaTeX_Math;font-weight:700;font-style:italic}.katex .amsrm,.katex .mathbb,.katex .textbb{font-family:KaTeX_AMS}.katex .mathcal{font-family:KaTeX_Caligraphic}.katex .mathfrak,.katex .textfrak{font-family:KaTeX_Fraktur}.katex .mathtt{font-family:KaTeX_Typewriter}.katex .mathscr,.katex .textscr{font-family:KaTeX_Script}.katex .mathsf,.katex .textsf{font-family:KaTeX_SansSerif}.katex .mathboldsf,.katex .textboldsf{font-family:KaTeX_SansSerif;font-weight:700}.katex .mathitsf,.katex .textitsf{font-family:KaTeX_SansSerif;font-style:italic}.katex .mainrm{font-family:KaTeX_Main;font-style:normal}.katex .vlist-t{display:inline-table;table-layout:fixed;border-collapse:collapse}.katex .vlist-r{display:table-row}.katex .vlist{display:table-cell;vertical-align:bottom;position:relative}.katex .vlist>span{display:block;height:0;position:relative}.katex .vlist>span>span{display:inline-block}.katex .vlist>span>.pstrut{overflow:hidden;width:0}.katex .vlist-t2{margin-right:-2px}.katex .vlist-s{display:table-cell;vertical-align:bottom;font-size:1px;width:2px;min-width:2px}.katex .vbox{display:inline-flex;flex-direction:column;align-items:baseline}.katex .hbox{width:100%}.katex .hbox,.katex .thinbox{display:inline-flex;flex-direction:row}.katex .thinbox{width:0;max-width:0}.katex .msupsub{text-align:left}.katex .mfrac>span>span{text-align:center}.katex .mfrac .frac-line{display:inline-block;width:100%;border-bottom-style:solid}.katex .hdashline,.katex .hline,.katex .mfrac .frac-line,.katex .overline .overline-line,.katex .rule,.katex .underline .underline-line{min-height:1px}.katex .mspace{display:inline-block}.katex .clap,.katex .llap,.katex .rlap{width:0;position:relative}.katex .clap>.inner,.katex .llap>.inner,.katex .rlap>.inner{position:absolute}.katex .clap>.fix,.katex .llap>.fix,.katex .rlap>.fix{display:inline-block}.katex .llap>.inner{right:0}.katex .clap>.inner,.katex .rlap>.inner{left:0}.katex .clap>.inner>span{margin-left:-50%;margin-right:50%}.katex .rule{display:inline-block;border:0 solid;position:relative}.katex .hline,.katex .overline .overline-line,.katex .underline .underline-line{display:inline-block;width:100%;border-bottom-style:solid}.katex .hdashline{display:inline-block;width:100%;border-bottom-style:dashed}.katex .sqrt>.root{margin-left:.27777778em;margin-right:-.55555556em}.katex .fontsize-ensurer.reset-size1.size1,.katex .sizing.reset-size1.size1{font-size:1em}.katex .fontsize-ensurer.reset-size1.size2,.katex .sizing.reset-size1.size2{font-size:1.2em}.katex .fontsize-ensurer.reset-size1.size3,.katex .sizing.reset-size1.size3{font-size:1.4em}.katex .fontsize-ensurer.reset-size1.size4,.katex .sizing.reset-size1.size4{font-size:1.6em}.katex .fontsize-ensurer.reset-size1.size5,.katex .sizing.reset-size1.size5{font-size:1.8em}.katex .fontsize-ensurer.reset-size1.size6,.katex .sizing.reset-size1.size6{font-size:2em}.katex .fontsize-ensurer.reset-size1.size7,.katex .sizing.reset-size1.size7{font-size:2.4em}.katex .fontsize-ensurer.reset-size1.size8,.katex .sizing.reset-size1.size8{font-size:2.88em}.katex .fontsize-ensurer.reset-size1.size9,.katex .sizing.reset-size1.size9{font-size:3.456em}.katex .fontsize-ensurer.reset-size1.size10,.katex .sizing.reset-size1.size10{font-size:4.148em}.katex .fontsize-ensurer.reset-size1.size11,.katex .sizing.reset-size1.size11{font-size:4.976em}.katex .fontsize-ensurer.reset-size2.size1,.katex .sizing.reset-size2.size1{font-size:.83333333em}.katex .fontsize-ensurer.reset-size2.size2,.katex .sizing.reset-size2.size2{font-size:1em}.katex .fontsize-ensurer.reset-size2.size3,.katex .sizing.reset-size2.size3{font-size:1.16666667em}.katex .fontsize-ensurer.reset-size2.size4,.katex .sizing.reset-size2.size4{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size2.size5,.katex .sizing.reset-size2.size5{font-size:1.5em}.katex .fontsize-ensurer.reset-size2.size6,.katex .sizing.reset-size2.size6{font-size:1.66666667em}.katex .fontsize-ensurer.reset-size2.size7,.katex .sizing.reset-size2.size7{font-size:2em}.katex .fontsize-ensurer.reset-size2.size8,.katex .sizing.reset-size2.size8{font-size:2.4em}.katex .fontsize-ensurer.reset-size2.size9,.katex .sizing.reset-size2.size9{font-size:2.88em}.katex .fontsize-ensurer.reset-size2.size10,.katex .sizing.reset-size2.size10{font-size:3.45666667em}.katex .fontsize-ensurer.reset-size2.size11,.katex .sizing.reset-size2.size11{font-size:4.14666667em}.katex .fontsize-ensurer.reset-size3.size1,.katex .sizing.reset-size3.size1{font-size:.71428571em}.katex .fontsize-ensurer.reset-size3.size2,.katex .sizing.reset-size3.size2{font-size:.85714286em}.katex .fontsize-ensurer.reset-size3.size3,.katex .sizing.reset-size3.size3{font-size:1em}.katex .fontsize-ensurer.reset-size3.size4,.katex .sizing.reset-size3.size4{font-size:1.14285714em}.katex .fontsize-ensurer.reset-size3.size5,.katex .sizing.reset-size3.size5{font-size:1.28571429em}.katex .fontsize-ensurer.reset-size3.size6,.katex .sizing.reset-size3.size6{font-size:1.42857143em}.katex .fontsize-ensurer.reset-size3.size7,.katex .sizing.reset-size3.size7{font-size:1.71428571em}.katex .fontsize-ensurer.reset-size3.size8,.katex .sizing.reset-size3.size8{font-size:2.05714286em}.katex .fontsize-ensurer.reset-size3.size9,.katex .sizing.reset-size3.size9{font-size:2.46857143em}.katex .fontsize-ensurer.reset-size3.size10,.katex .sizing.reset-size3.size10{font-size:2.96285714em}.katex .fontsize-ensurer.reset-size3.size11,.katex .sizing.reset-size3.size11{font-size:3.55428571em}.katex .fontsize-ensurer.reset-size4.size1,.katex .sizing.reset-size4.size1{font-size:.625em}.katex .fontsize-ensurer.reset-size4.size2,.katex .sizing.reset-size4.size2{font-size:.75em}.katex .fontsize-ensurer.reset-size4.size3,.katex .sizing.reset-size4.size3{font-size:.875em}.katex .fontsize-ensurer.reset-size4.size4,.katex .sizing.reset-size4.size4{font-size:1em}.katex .fontsize-ensurer.reset-size4.size5,.katex .sizing.reset-size4.size5{font-size:1.125em}.katex .fontsize-ensurer.reset-size4.size6,.katex .sizing.reset-size4.size6{font-size:1.25em}.katex .fontsize-ensurer.reset-size4.size7,.katex .sizing.reset-size4.size7{font-size:1.5em}.katex .fontsize-ensurer.reset-size4.size8,.katex .sizing.reset-size4.size8{font-size:1.8em}.katex .fontsize-ensurer.reset-size4.size9,.katex .sizing.reset-size4.size9{font-size:2.16em}.katex .fontsize-ensurer.reset-size4.size10,.katex .sizing.reset-size4.size10{font-size:2.5925em}.katex .fontsize-ensurer.reset-size4.size11,.katex .sizing.reset-size4.size11{font-size:3.11em}.katex .fontsize-ensurer.reset-size5.size1,.katex .sizing.reset-size5.size1{font-size:.55555556em}.katex .fontsize-ensurer.reset-size5.size2,.katex .sizing.reset-size5.size2{font-size:.66666667em}.katex .fontsize-ensurer.reset-size5.size3,.katex .sizing.reset-size5.size3{font-size:.77777778em}.katex .fontsize-ensurer.reset-size5.size4,.katex .sizing.reset-size5.size4{font-size:.88888889em}.katex .fontsize-ensurer.reset-size5.size5,.katex .sizing.reset-size5.size5{font-size:1em}.katex .fontsize-ensurer.reset-size5.size6,.katex .sizing.reset-size5.size6{font-size:1.11111111em}.katex .fontsize-ensurer.reset-size5.size7,.katex .sizing.reset-size5.size7{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size5.size8,.katex .sizing.reset-size5.size8{font-size:1.6em}.katex .fontsize-ensurer.reset-size5.size9,.katex .sizing.reset-size5.size9{font-size:1.92em}.katex .fontsize-ensurer.reset-size5.size10,.katex .sizing.reset-size5.size10{font-size:2.30444444em}.katex .fontsize-ensurer.reset-size5.size11,.katex .sizing.reset-size5.size11{font-size:2.76444444em}.katex .fontsize-ensurer.reset-size6.size1,.katex .sizing.reset-size6.size1{font-size:.5em}.katex .fontsize-ensurer.reset-size6.size2,.katex .sizing.reset-size6.size2{font-size:.6em}.katex .fontsize-ensurer.reset-size6.size3,.katex .sizing.reset-size6.size3{font-size:.7em}.katex .fontsize-ensurer.reset-size6.size4,.katex .sizing.reset-size6.size4{font-size:.8em}.katex .fontsize-ensurer.reset-size6.size5,.katex .sizing.reset-size6.size5{font-size:.9em}.katex .fontsize-ensurer.reset-size6.size6,.katex .sizing.reset-size6.size6{font-size:1em}.katex .fontsize-ensurer.reset-size6.size7,.katex .sizing.reset-size6.size7{font-size:1.2em}.katex .fontsize-ensurer.reset-size6.size8,.katex .sizing.reset-size6.size8{font-size:1.44em}.katex .fontsize-ensurer.reset-size6.size9,.katex .sizing.reset-size6.size9{font-size:1.728em}.katex .fontsize-ensurer.reset-size6.size10,.katex .sizing.reset-size6.size10{font-size:2.074em}.katex .fontsize-ensurer.reset-size6.size11,.katex .sizing.reset-size6.size11{font-size:2.488em}.katex .fontsize-ensurer.reset-size7.size1,.katex .sizing.reset-size7.size1{font-size:.41666667em}.katex .fontsize-ensurer.reset-size7.size2,.katex .sizing.reset-size7.size2{font-size:.5em}.katex .fontsize-ensurer.reset-size7.size3,.katex .sizing.reset-size7.size3{font-size:.58333333em}.katex .fontsize-ensurer.reset-size7.size4,.katex .sizing.reset-size7.size4{font-size:.66666667em}.katex .fontsize-ensurer.reset-size7.size5,.katex .sizing.reset-size7.size5{font-size:.75em}.katex .fontsize-ensurer.reset-size7.size6,.katex .sizing.reset-size7.size6{font-size:.83333333em}.katex .fontsize-ensurer.reset-size7.size7,.katex .sizing.reset-size7.size7{font-size:1em}.katex .fontsize-ensurer.reset-size7.size8,.katex .sizing.reset-size7.size8{font-size:1.2em}.katex .fontsize-ensurer.reset-size7.size9,.katex .sizing.reset-size7.size9{font-size:1.44em}.katex .fontsize-ensurer.reset-size7.size10,.katex .sizing.reset-size7.size10{font-size:1.72833333em}.katex .fontsize-ensurer.reset-size7.size11,.katex .sizing.reset-size7.size11{font-size:2.07333333em}.katex .fontsize-ensurer.reset-size8.size1,.katex .sizing.reset-size8.size1{font-size:.34722222em}.katex .fontsize-ensurer.reset-size8.size2,.katex .sizing.reset-size8.size2{font-size:.41666667em}.katex .fontsize-ensurer.reset-size8.size3,.katex .sizing.reset-size8.size3{font-size:.48611111em}.katex .fontsize-ensurer.reset-size8.size4,.katex .sizing.reset-size8.size4{font-size:.55555556em}.katex .fontsize-ensurer.reset-size8.size5,.katex .sizing.reset-size8.size5{font-size:.625em}.katex .fontsize-ensurer.reset-size8.size6,.katex .sizing.reset-size8.size6{font-size:.69444444em}.katex .fontsize-ensurer.reset-size8.size7,.katex .sizing.reset-size8.size7{font-size:.83333333em}.katex .fontsize-ensurer.reset-size8.size8,.katex .sizing.reset-size8.size8{font-size:1em}.katex .fontsize-ensurer.reset-size8.size9,.katex .sizing.reset-size8.size9{font-size:1.2em}.katex .fontsize-ensurer.reset-size8.size10,.katex .sizing.reset-size8.size10{font-size:1.44027778em}.katex .fontsize-ensurer.reset-size8.size11,.katex .sizing.reset-size8.size11{font-size:1.72777778em}.katex .fontsize-ensurer.reset-size9.size1,.katex .sizing.reset-size9.size1{font-size:.28935185em}.katex .fontsize-ensurer.reset-size9.size2,.katex .sizing.reset-size9.size2{font-size:.34722222em}.katex .fontsize-ensurer.reset-size9.size3,.katex .sizing.reset-size9.size3{font-size:.40509259em}.katex .fontsize-ensurer.reset-size9.size4,.katex .sizing.reset-size9.size4{font-size:.46296296em}.katex .fontsize-ensurer.reset-size9.size5,.katex .sizing.reset-size9.size5{font-size:.52083333em}.katex .fontsize-ensurer.reset-size9.size6,.katex .sizing.reset-size9.size6{font-size:.5787037em}.katex .fontsize-ensurer.reset-size9.size7,.katex .sizing.reset-size9.size7{font-size:.69444444em}.katex .fontsize-ensurer.reset-size9.size8,.katex .sizing.reset-size9.size8{font-size:.83333333em}.katex .fontsize-ensurer.reset-size9.size9,.katex .sizing.reset-size9.size9{font-size:1em}.katex .fontsize-ensurer.reset-size9.size10,.katex .sizing.reset-size9.size10{font-size:1.20023148em}.katex .fontsize-ensurer.reset-size9.size11,.katex .sizing.reset-size9.size11{font-size:1.43981481em}.katex .fontsize-ensurer.reset-size10.size1,.katex .sizing.reset-size10.size1{font-size:.24108004em}.katex .fontsize-ensurer.reset-size10.size2,.katex .sizing.reset-size10.size2{font-size:.28929605em}.katex .fontsize-ensurer.reset-size10.size3,.katex .sizing.reset-size10.size3{font-size:.33751205em}.katex .fontsize-ensurer.reset-size10.size4,.katex .sizing.reset-size10.size4{font-size:.38572806em}.katex .fontsize-ensurer.reset-size10.size5,.katex .sizing.reset-size10.size5{font-size:.43394407em}.katex .fontsize-ensurer.reset-size10.size6,.katex .sizing.reset-size10.size6{font-size:.48216008em}.katex .fontsize-ensurer.reset-size10.size7,.katex .sizing.reset-size10.size7{font-size:.57859209em}.katex .fontsize-ensurer.reset-size10.size8,.katex .sizing.reset-size10.size8{font-size:.69431051em}.katex .fontsize-ensurer.reset-size10.size9,.katex .sizing.reset-size10.size9{font-size:.83317261em}.katex .fontsize-ensurer.reset-size10.size10,.katex .sizing.reset-size10.size10{font-size:1em}.katex .fontsize-ensurer.reset-size10.size11,.katex .sizing.reset-size10.size11{font-size:1.19961427em}.katex .fontsize-ensurer.reset-size11.size1,.katex .sizing.reset-size11.size1{font-size:.20096463em}.katex .fontsize-ensurer.reset-size11.size2,.katex .sizing.reset-size11.size2{font-size:.24115756em}.katex .fontsize-ensurer.reset-size11.size3,.katex .sizing.reset-size11.size3{font-size:.28135048em}.katex .fontsize-ensurer.reset-size11.size4,.katex .sizing.reset-size11.size4{font-size:.32154341em}.katex .fontsize-ensurer.reset-size11.size5,.katex .sizing.reset-size11.size5{font-size:.36173633em}.katex .fontsize-ensurer.reset-size11.size6,.katex .sizing.reset-size11.size6{font-size:.40192926em}.katex .fontsize-ensurer.reset-size11.size7,.katex .sizing.reset-size11.size7{font-size:.48231511em}.katex .fontsize-ensurer.reset-size11.size8,.katex .sizing.reset-size11.size8{font-size:.57877814em}.katex .fontsize-ensurer.reset-size11.size9,.katex .sizing.reset-size11.size9{font-size:.69453376em}.katex .fontsize-ensurer.reset-size11.size10,.katex .sizing.reset-size11.size10{font-size:.83360129em}.katex .fontsize-ensurer.reset-size11.size11,.katex .sizing.reset-size11.size11{font-size:1em}.katex .delimsizing.size1{font-family:KaTeX_Size1}.katex .delimsizing.size2{font-family:KaTeX_Size2}.katex .delimsizing.size3{font-family:KaTeX_Size3}.katex .delimsizing.size4{font-family:KaTeX_Size4}.katex .delimsizing.mult .delim-size1>span{font-family:KaTeX_Size1}.katex .delimsizing.mult .delim-size4>span{font-family:KaTeX_Size4}.katex .nulldelimiter{display:inline-block;width:.12em}.katex .delimcenter,.katex .op-symbol{position:relative}.katex .op-symbol.small-op{font-family:KaTeX_Size1}.katex .op-symbol.large-op{font-family:KaTeX_Size2}.katex .accent>.vlist-t,.katex .op-limits>.vlist-t{text-align:center}.katex .accent .accent-body{position:relative}.katex .accent .accent-body:not(.accent-full){width:0}.katex .overlay{display:block}.katex .mtable .vertical-separator{display:inline-block;min-width:1px}.katex .mtable .arraycolsep{display:inline-block}.katex .mtable .col-align-c>.vlist-t{text-align:center}.katex .mtable .col-align-l>.vlist-t{text-align:left}.katex .mtable .col-align-r>.vlist-t{text-align:right}.katex .svg-align{text-align:left}.katex svg{display:block;position:absolute;width:100%;height:inherit;fill:currentColor;stroke:currentColor;fill-rule:nonzero;fill-opacity:1;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1}.katex svg path{stroke:none}.katex img{border-style:none;min-width:0;min-height:0;max-width:none;max-height:none}.katex .stretchy{width:100%;display:block;position:relative;overflow:hidden}.katex .stretchy:after,.katex .stretchy:before{content:""}.katex .hide-tail{width:100%;position:relative;overflow:hidden}.katex .halfarrow-left{position:absolute;left:0;width:50.2%;overflow:hidden}.katex .halfarrow-right{position:absolute;right:0;width:50.2%;overflow:hidden}.katex .brace-left{position:absolute;left:0;width:25.1%;overflow:hidden}.katex .brace-center{position:absolute;left:25%;width:50%;overflow:hidden}.katex .brace-right{position:absolute;right:0;width:25.1%;overflow:hidden}.katex .x-arrow-pad{padding:0 .5em}.katex .cd-arrow-pad{padding:0 .55556em 0 .27778em}.katex .mover,.katex .munder,.katex .x-arrow{text-align:center}.katex .boxpad{padding:0 .3em}.katex .fbox,.katex .fcolorbox{box-sizing:border-box;border:.04em solid}.katex .cancel-pad{padding:0 .2em}.katex .cancel-lap{margin-left:-.2em;margin-right:-.2em}.katex .sout{border-bottom-style:solid;border-bottom-width:.08em}.katex .angl{box-sizing:border-content;border-top:.049em solid;border-right:.049em solid;margin-right:.03889em}.katex .anglpad{padding:0 .03889em}.katex .eqn-num:before{counter-increment:katexEqnNo;content:"(" counter(katexEqnNo) ")"}.katex .mml-eqn-num:before{counter-increment:mmlEqnNo;content:"(" counter(mmlEqnNo) ")"}.katex .mtr-glue{width:50%}.katex .cd-vert-arrow{display:inline-block;position:relative}.katex .cd-label-left{display:inline-block;position:absolute;right:calc(50% + .3em);text-align:left}.katex .cd-label-right{display:inline-block;position:absolute;left:calc(50% + .3em);text-align:right}.katex-display{display:block;margin:1em 0;text-align:center}.katex-display>.katex{display:block;text-align:center;white-space:nowrap}.katex-display>.katex>.katex-html{display:block;position:relative}.katex-display>.katex>.katex-html>.tag{position:absolute;right:0}.katex-display.leqno>.katex>.katex-html>.tag{left:0;right:auto}.katex-display.fleqn>.katex{text-align:left;padding-left:2em}body{counter-reset:katexEqnNo mmlEqnNo}

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.katex-error {
	color: var(--vscode-editorError-foreground);
}

</style>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        
    </head>
    <body class="vscode-body vscode-light">
        <h1 id="11-asynchrone-methoden-und-parallelität">11 Asynchrone Methoden und Parallelität</h1>
<style>
#coralbox
{
    background-color:lightcoral;
    color:black ;
    padding: 10px ;
    margin-top:10px ;
    margin-bottom:10px ;
}
#bluebox
{
    background-color:lightskyblue;
    color:black ;
    padding: 10px ;
    margin-top:10px ;
    margin-bottom:10px ;
}
body
{
    font-family: "Times New Roman", Times, serif;
}
h1
{
    font-family: Arial, Helvetica, sans-serif;
}
h2
{
    font-family: Arial, Helvetica, sans-serif;
    font-style: italic;
    font-weight: bold;
    margin-top:20px;
}
h3
{
    font-family: Arial, Helvetica, sans-serif;
    font-weight: bold;
    margin-top:20px;
}
code
{
   font-family: "Courier New", "Lucida Console", monospace;
   color: green;
}
img
{
  display: block;
  margin-left: auto;
  margin-right: auto;
}
</style>
<h2 id="ziele">Ziele</h2>
<p>Asynchrone Methoden sind eine elegante Möglichkeit der nebenläufigen und parallelen Programmierung. In diesem Kapitel werden die folgenden Fragen geklärt:</p>
<ul>
<li>Warum ist das sequentielle Abarbeiten von Methoden nicht immer optimal?</li>
<li>Was ist Nebenläufigkeit?</li>
<li>Wie kann eine rufende Methode weiter arbeiten, auch wenn die gerufene Methode blockiert und daher noch gar nicht fertig ist?</li>
<li>Wie können die Zugriffe auf gemeinsam genutzte Ressourcen koordiniert werden?</li>
<li>Wie kann auf Ergebnisse parallel ausgeführter Programmteile zugegriffen werden?</li>
<li>Wie können mehrere Methoden gleichzeitig ausgeführt werden?</li>
</ul>
<h2 id="problemstellung-professor-hausmann-macht-seinem-namen-ehre">Problemstellung: Professor Hausmann macht seinem Namen Ehre</h2>
<p>Professor Hausmann ist ein moderner Ehemann, also arbeitet er im Haushalt mit. Eine seiner Hauptaufgaben ist das Wäschewaschen mit den folgenden Schritten:</p>
<ol>
<li>Wäsche zusammensuchen</li>
<li>Waschmaschine befüllen</li>
<li>Waschen (in der Waschmaschine)</li>
<li>Wäsche entnehmen</li>
<li>Wäsche aufhängen</li>
</ol>
<p>Professor Hausmann ist Beamter, der sich mit Hingabe seinen Aufgaben widmet. So kann er seine Büroarbeit für die Hochschule erst nach vollständigem Abschluss des Wäschewaschens angehen.</p>
<p>Abends erzählt er stolz seiner praktisch veranlagten Ehefrau von seinen Taten im Haushalt. Doch die schüttelt bloß den Kopf über Männer im Allgemeinen und Professoren im Besonderen: Zumindest während des Waschens in der Waschmaschine hätte ihr Ehemann schon mal mit seiner Büroarbeit anfangen können.</p>
<p>Professor Hausmann ist frustriert und will nun versuchen, das Konzept des parallelen Arbeitens auch auf seine Hausarbeit anzuwenden.</p>
<h2 id="theorie-parallelität-und-threads">Theorie: Parallelität und Threads</h2>
<div id="coralbox">
Ein <i>Prozess</i> ist ein Vorgang, der durch ein Programm kontrolliert wird. Mehrere Prozesse heißen <i>nebenläufig</i>, wenn sie voneinander unabhängig bearbeitet werden können. Für nebenläufige Prozesse ist es gleichgültig, ob sie nacheinander oder gleichzeitig ausgeführt werden. Prozesse heißen <i>parallel</i>, wenn sie nebenläufig sind und gleichzeitig bearbeitet werden. Ein Prozess kann wiederum in Unterprozesse aufgeteilt werden, die nebenläufig oder parallel ablaufen. Ein solcher Unterprozesse heißt <i>Thread</i> (Ablauffaden). Der zuerst gestartete Thread eines Prozesses heißt <i>Hauptthread</i>.
</div>
<p><img src="Bilder/seriellerAblauf.jpg" alt="serieller Ablauf"></p>
<p><img src="Bilder/Threading.jpg" alt="Threading"></p>
<h2 id="umsetzung-in-c-threading">Umsetzung in C#: Threading</h2>
<p>In C# stellt der Namensraum <code>System.Threading</code> Werkzeuge für das Erzeugen und Starten von Threads zur Verfügung:</p>
<ul>
<li>Die Methode <code>Main</code> und alle von ihr gerufenen Methoden liegen im Hauptthread.</li>
<li>Es ist möglich, eine Methode in einen neuen Thread zu legen und diese Methode sowie alle von ihr gerufenen Methoden somit parallel zum Hauptthread auszuführen.</li>
</ul>
<p>Allerdings folgt so der Quellcode einer technischen Vorgabe und nicht seiner inneren Logik. Es gibt alternative und neuere Konzepte für Parallelität in C#.</p>
<div id="bluebox">
Die (direkte) Anwendung des Threading wird deshalb nicht mehr empfohlen.
</div>
<p>(Falls Sie sich dennoch dafür interessieren: → VS5 „Threading“).</p>
<h2 id="theorie-asynchronität">Theorie: Asynchronität</h2>
<div id="coralbox">
Normalerweise erfolgt ein Methodenaufruf <i>synchron</i>: Die rufende Methode muss warten, bis die gerufene Methode fertig ist.
</div>
<p>Die rufende Methode ist also so lange blockiert, bis die gerufene Methode ihre Arbeit beendet hat. Das kann notwendig sein, wenn die rufende Methode das Ergebnis der gerufenen Methode zum Weiterarbeiten benötigt.</p>
<p>Hat die rufende Methode aber noch andere Tätigkeiten zu tun, die (erst einmal) nicht auf die Ergebnisse der gerufenen Methode angewiesen sind, so liegt potentiell Nebenläufigkeit vor.</p>
<div id="coralbox">
Bei einem <i>asynchronen Methodenaufruf</i> gibt die gerufene Methode der rufenden vorzeitig die Kontrolle zurück. Ab diesem Zeitpunkt arbeiten rufende und gerufene Methode nebenläufig, im Idealfall parallel.
</div>
<p>Diese Vorgehensweise hat mehrere Vorteile:</p>
<ul>
<li>Bei mehreren Prozessorkernen (wie auf modernen Rechnern mittlerweile Standard) können die Methoden tatsächlich parallel ablaufen und sparen somit Zeit.</li>
<li>Ist die gerufene Methode selbst blockiert, z.B. weil sie auf Daten vom Datenträger wartet, so kann zumindest die rufende Methode weitermachen (auch ganz ohne mehrere Prozessorkerne).</li>
<li>Technisch gesehen spaltet sich die gerufene Methode in einem eigenen Thread ab. Wird die Asynchronität aber geschickt von der Programmiersprache unterstützt, so muss sich der Programmierer nicht darum kümmern.</li>
</ul>
<p><img src="Bilder/asynchroneMethoden.jpg" alt="asynchrone Methoden"></p>
<h2 id="umsetzung-in-c-asynchrone-methoden">Umsetzung in C#: asynchrone Methoden</h2>
<p>Asynchrone Methodenaufrufe werden in C# unterstützt. Dazu muss der Namensraum <code>System.Threading.Tasks</code> eingebunden werden. Darin befindet sich eine Klasse <code>Task</code>. Ein Objekt dieser Klasse stellt eine Aufgabe dar, die nebenläufig zu anderen Aufgaben ausgeführt werden kann (man beachte den Fokus auf inhaltlich „Aufgabe“, nicht technisch „Thread“). Die Klasse <code>Task</code> gibt es in zwei Varianten:</p>
<ul>
<li>als generische Klasse mit Typparameter <code>TResult</code>, falls die Aufgabe ein Objekt vom Typ <code>TResult</code> als Ergebnis liefert, und</li>
<li>als nicht-generische Klasse, falls es kein Ergebnisobjekt gibt.</li>
</ul>
<p>Die generische Klasse ist Unterklasse der nicht-generischen Klasse <code>Task</code>. Weiter enthalten die Klassen einige nützliche Methoden, z.B.</p>
<ul>
<li><code>public static Task Delay(int millisecondsDelay)</code><br>
Diese Methode erzeugt eine nebenläufige Aufgabe, die nichts weiter tut als die angegebene Zeit abzuwarten, und startet sie in einem eigenen Ablauffaden.</li>
<li><code>public static Task Run (Action action)</code><br>
Diese Methode erzeugt eine nebenläufige Aufgabe zur Durchführung der Methode <code>action</code>
und startet sie in einem eigenen Ablauffaden.</li>
<li><code>public static Task&lt;TResult&gt; Run&lt;TResult&gt; (Func&lt;TResult&gt; function)</code><br>
Diese Methode erzeugt eine nebenläufige Aufgabe zur Durchführung der Methode <code>function</code> (die
im Gegensatz zu <code>action</code> oben einen Rückgabewert vom Typ <code>TResult</code> hat)
und startet sie in einem eigenen Ablauffaden.<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></li>
<li><code>public void Wait()</code><br>
Diese Methode wartet auf die Beendigung einer nebenläufigen Aufgabe, d.h. der Ablauffaden, in
dem diese Methode ausgeführt wird, wird so lange angehalten bis diese Aufgabe beendet ist.</li>
</ul>
<p>Die Methode <code>Tätigkeit</code> simuliert somit eine Tätigkeit <code>bezeichnung</code>,
die den Zeitverbrauch <code>dauer</code> in Millisekunden hat:</p>
<pre><code class="language-C#"><div>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> Tätigkeit(<span class="hljs-built_in">string</span> bezeichnung, <span class="hljs-built_in">int</span> dauer)
    {
        Console.WriteLine(<span class="hljs-string">$&quot;Beginn: <span class="hljs-subst">{bezeichnung}</span>&quot;</span>);
        Task.Delay(dauer).Wait();
        Console.WriteLine(<span class="hljs-string">$&quot;Ende: <span class="hljs-subst">{bezeichnung}</span>&quot;</span>);
    }
</div></code></pre>
<p>Um Professor Hausmann helfen zu können bauen wir sein Problem nach. Er hat zwei Aufgaben, nämlich Wäschewachen und Büroarbeit. Diese Aufgaben können als Methoden dargestellt werden (→ <code>V11-Hausmann-1</code>):</p>
<pre><code class="language-C#"><div>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> WäscheWaschen()
    {
        Console.WriteLine(<span class="hljs-string">$&quot;Aufgabe: Wäsche waschen&quot;</span>);
        Tätigkeit(<span class="hljs-string">&quot;Wäsche zusammensuchen&quot;</span>, <span class="hljs-number">2000</span>);
        Tätigkeit(<span class="hljs-string">&quot;Waschmaschine befüllen&quot;</span>, <span class="hljs-number">1000</span>);
        Tätigkeit(<span class="hljs-string">&quot;Waschen (Waschmaschine)&quot;</span>, <span class="hljs-number">10000</span>);
        Tätigkeit(<span class="hljs-string">&quot;Wäsche entnehmen&quot;</span>, <span class="hljs-number">1000</span>);
        Tätigkeit(<span class="hljs-string">&quot;Wäsche aufhängen&quot;</span>, <span class="hljs-number">3000</span>);
        Console.WriteLine(<span class="hljs-string">$&quot;Wäsche waschen beendet&quot;</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> Büroarbeit()
    {
        Console.WriteLine(<span class="hljs-string">$&quot;Aufgabe: Büroarbeit&quot;</span>);
        Tätigkeit(<span class="hljs-string">&quot;Büroarbeit&quot;</span>, <span class="hljs-number">7000</span>);
        Console.WriteLine(<span class="hljs-string">$&quot;Büroarbeit beendet&quot;</span>);
    }
</div></code></pre>
<p>Diese Methoden können in dieser Form tatsächlich nur nacheinander ausgeführt werden:</p>
<pre><code class="language-C#"><div>        WäscheWaschen();
        Büroarbeit();
</div></code></pre>
<p>Wir haben es hier also mit einem gewöhnlichen seriellen Ablauf zu tun. So bleibt Professor Hausmann tatsächlich die ganze Zeit neben der laufenden Waschmaschine stehen und tut nichts anderes. Das ist nicht sehr schlau, denn für die Büroarbeit braucht es keine frische Wäsche. Also kann Professor Hausmann die Aufgabe des Waschens der Waschmaschine überlassen und sich selbst der Hochschule widmen.</p>
<p>Die Aufgabe des Wäschewaschens muss als nebenläufig (von der Waschmaschine) durchzuführend gekennzeichnet werden. Dazu</p>
<ul>
<li>wird die Methode mit dem Schlüsselwort <code>async</code> gekennzeichnet,</li>
<li>erhält sie den Rückgabewert <code>Task</code> (anstelle von <code>void</code>),</li>
<li>erhält ihr Bezeichner die Endung <code>Async</code> (das ist zwar nur eine Konvention, sollte aber trotzdem gemacht werden),</li>
<li>wird die Stelle, an der Professor Hausmann das Waschen der Waschmaschine überlassen kann, mit dem Schlüsselwort <code>await</code> gekennzeichnet.</li>
</ul>
<p><code>WäscheWaschen</code> ist somit zur asynchronen Methode <code>WäscheWaschenAsync</code> geworden (→ <code>V11-Hausmann-2</code>).</p>
<pre><code class="language-C#"><div>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> Task WäscheWaschenAsync()
    {
        Console.WriteLine(<span class="hljs-string">$&quot;Aufgabe: Wäsche waschen&quot;</span>);
        Tätigkeit(<span class="hljs-string">&quot;Wäsche zusammensuchen&quot;</span>, <span class="hljs-number">2000</span>);
        Tätigkeit(<span class="hljs-string">&quot;Waschmaschine befüllen&quot;</span>, <span class="hljs-number">1000</span>);
        <span class="hljs-keyword">await</span> Task.Run(() =&gt; Tätigkeit(<span class="hljs-string">&quot;Waschen (Waschmaschine)&quot;</span>, <span class="hljs-number">10000</span>));
        Tätigkeit(<span class="hljs-string">&quot;Wäsche entnehmen&quot;</span>, <span class="hljs-number">1000</span>);
        Tätigkeit(<span class="hljs-string">&quot;Wäsche aufhängen&quot;</span>, <span class="hljs-number">3000</span>);
        Console.WriteLine(<span class="hljs-string">$&quot;Wäsche waschen beendet&quot;</span>);
    }
</div></code></pre>
<p>In der Zeile<br>
<code>await Task.Run(() =&gt; Tätigkeit(&quot;Waschen (Waschmaschine)&quot;, 10000));</code><br>
geschehen drei Dinge:</p>
<ul>
<li>Es wird eine neue nebenläufige Aufgabe für <code>Tätigkeit(&quot;Waschen (Waschmaschine)&quot;, 10000)</code> erzeugt.
Diese Aufgabe läuft in einem eigenen neuen Ablauffaden. Da <code>Tätigkeiten</code> keine asynchrone
Methode ist, ist dazu ein Aufruf von <code>Task.Run</code> notwendig.</li>
<li>Der Ablauffaden, der die neue Aufgabe erzeugt  und die bisherigen Tätigkeiten durchgeführt hat,
verlässt aufgrund des Schlüsselwortes <code>await</code> die Methode <code>WäscheWaschenAsync</code> und kehrt
zur rufenden Methode zurück. Hier ist das die Methode <code>Main</code>, die nun die Büroarbeit startet.</li>
<li>Der Rest der Methode <code>WäscheWaschenAsync</code> wird in einem weiteren neuen Ablauffaden ausgeführt.
Dieser neue Ablauffaden wird durch <code>await</code> aber erst einmal so lange angehalten, bis die
Tätigkeit des Waschens in der Waschmaschine beendet ist. <sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup></li>
</ul>
<p>Das Schlüsselwort <code>await</code> darf nur in Aufgaben (also: asynchronen Methoden) vorkommen und wird nur auf Aufgaben angewendet.</p>
<div id="bluebox">
Eine asynchrone Methode ohne <code>await</code> ist sinnlos.
</div>
<p>Professor Hausmann kann also das Wäschewaschen beginnen und zu gegebener Zeit zur Büroarbeit wechseln. Damit er seiner Ehefrau stolz von seiner (diesmal parallelen) Hausarbeit berichten kann, sollte er aber das Ende des Wäschewaschens noch abwarten: <sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup></p>
<pre><code class="language-C#"><div>    Task wäscheWaschen = WäscheWaschenAsync();
    Büroarbeit();
    wäscheWaschen.Wait();
</div></code></pre>
<p>Aber halt: Das Ganze klappt hier nur, weil Professor Hausmann mit seiner Büroarbeit schneller fertig ist als die Waschmaschine mit ihrer Wäsche. Bräuchte er länger, so müsste er gleichzeitig Büroarbeit machen und Wäsche aufhängen, oder die Waschmaschine müsste die Wäsche aufhängen. Beides entspricht nicht der Lebenserfahrung.</p>
<h2 id="theorie-synchronisation">Theorie: Synchronisation</h2>
<p>Prozesse oder nebenläufige Programmteile konkurrieren miteinander um Ressourcen wie Console, Drucker, Datenstrukturen im Hauptspeicher oder Dateien im Massenspeicher, die sie nicht gleichzeitig nutzen können. Damit es kein Durcheinander gibt, müssen sie sich koordinieren.</p>
<div id="coralbox">
Stimmen sich nebenläufige Prozesse, Ablauffäden oder Aufgaben ab, um kontrolliert auf Ressourcen zuzugreifen,
so heißt dies <i>Synchronisation</i>.
</div>
<p>Es gibt verschiedene Möglichkeiten der Synchronisation; häufig kommt ein Überwacher zum Einsatz, der den Zugriff auf eine Ressource abwehrt, solange sie anderweitig genutzt wird.</p>
<div id="coralbox">
Ein <i>kritischer Abschnitt</i> besteht aus einer Abfolge von Anweisungen, die nicht von beliebig vielen
nebenläufigen Aufgaben gleichzeitig abgearbeitet werden darf. Ein <i>Semaphor</i> kontrolliert den Zugang zu
kritischen Abschnitten: Es weiß, wie viele Aufgaben gleichzeitig im kritischen Abschnitt arbeiten
dürfen. Ist diese Anzahl erreicht, müssen alle weiteren Aufgaben, die in diesen kritischen Abschnitt
hinein wollen, abwarten. Sobald eine Aufgabe den kritischen Abschnitt verlässt, darf die am längsten
wartende Aufgabe nachrücken. Eine <i>gemeinsame Variable</i> wird von mehreren nebenläufigen
Aufgaben geteilt. Anweisungen für Zugriffe, vor allem schreibende Zugriffe, auf gemeinsame
Variablen bilden grundsätzlich einen kritischen Abschnitt.
</div>
<p>Gefährlich wird es, wenn kritische Abschnitte überlappen, also eine Anweisung zu mehr als einem
kritischen Abschnitt gehört, was durchaus möglich ist. Um überlappende kritische Abschnitte zu
betreten, benötigt eine Aufgabe die Zugangsberechtigung zu allen von ihnen. Haben zwei Aufgaben
Zugang zu je einem der sich überlappenden kritischen Abschnitte und warten darauf, dass die
jeweils andere Aufgabe ihren Zugang aufgibt, so blockieren sie sich dauerhaft gegenseitig.</p>
<div id="coralbox">
Blockieren sich zwei Prozesse, Ablauffäden oder Aufgaben gegenseitig, so spricht man von einer <i>Verklemmung</i>.
</div>
<h2 id="umsetzung-in-c-lock-anweisung">Umsetzung in C#: <code>lock</code>-Anweisung</h2>
<p>Die Ressource hier ist Professor Hausmann. Er darf nur von einer Aufgabe gleichzeitig „genutzt“ werden.</p>
<p>Professor Hausmann hat keine Darstellung im bisherigen Programm, also führen wir sie ein als einfaches Objekt der Klasse <code>Object</code>:</p>
<pre><code class="language-C#"><div>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">object</span> _hausmann = <span class="hljs-keyword">new</span> <span class="hljs-built_in">object</span>();
</div></code></pre>
<p>Die Anweisung <code>lock</code> überwacht den Eingang zu einem kritischen Abschnitt: Befindet sich bereits eine Aufgabe in diesem kritischen Abschnitt, so müssen alle anderen, die hinein wollen, warten, bis sie fertig ist; dann darf die am längsten wartende Aufgabe nachrücken. Die Anweisung <code>lock</code> bezieht sich dabei auf eine Variable, die von mehreren Aufgaben genutzt wird.</p>
<div id="bluebox">
Die Variable, auf die sich die Lock-Anweisung bezieht, muss
<ul>
<li> eine Referenzvariable sein, die</li>
<li> auf ein Objekt verweist.</li>
</ul>
Eine Referenzvariable mit Wert <code>null</code> ist nicht ausreichend.
</div>
<p>Der <code>lock</code>-Anweisung folgt ein Block mit weiteren Anweisungen, die den kritischen Abschnitt bilden. Gibt es mehrere <code>lock</code>-Anweisungen, die sich alle auf dasselbe Objekt beziehen, so bilden alle ihre Blöcke einen gemeinsamen kritischen Abschnitt. Befindet sich also eine Aufgabe in einem dieser Blöcke, so sind alle anderen Blöcke auch gesperrt.</p>
<p>Also müssen alle Anweisungen, die Professor Hausmann nicht gleichzeitig erledigen kann, in einen kritischen Abschnitt hinein. Dieser kritische Abschnitt wird von einer <code>lock</code>-Anweisung geschützt, die sich auf das durch <code>_hausmann</code> referenzierte Objekt bezieht:</p>
<pre><code class="language-C#"><div>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> Task WäscheWaschenAsync()
    {
        Console.WriteLine(<span class="hljs-string">$&quot;Aufgabe: Wäsche waschen&quot;</span>);
        <span class="hljs-keyword">lock</span> (_hausmann)
        {
            Tätigkeit(<span class="hljs-string">&quot;Wäsche zusammensuchen&quot;</span>, <span class="hljs-number">2000</span>);
            Tätigkeit(<span class="hljs-string">&quot;Waschmaschine befüllen&quot;</span>, <span class="hljs-number">1000</span>);
        }
        <span class="hljs-keyword">await</span> Task.Run(() =&gt; Tätigkeit(<span class="hljs-string">&quot;Waschen (Waschmaschine)&quot;</span>, <span class="hljs-number">10000</span>));
        <span class="hljs-keyword">lock</span> (_hausmann)
        {
            Tätigkeit(<span class="hljs-string">&quot;Wäsche entnehmen&quot;</span>, <span class="hljs-number">1000</span>);
            Tätigkeit(<span class="hljs-string">&quot;Wäsche aufhängen&quot;</span>, <span class="hljs-number">3000</span>);
        }
        Console.WriteLine(<span class="hljs-string">$&quot;Wäsche waschen beendet&quot;</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> Büroarbeit()
    {
        Console.WriteLine(<span class="hljs-string">$&quot;Aufgabe: Büroarbeit&quot;</span>);
        <span class="hljs-keyword">lock</span> (_hausmann)
        {
            Tätigkeit(<span class="hljs-string">&quot;Büroarbeit&quot;</span>, <span class="hljs-number">12000</span>);
        }
        Console.WriteLine(<span class="hljs-string">$&quot;Büroarbeit beendet&quot;</span>);
    }
</div></code></pre>
<p>Die Büroarbeit liegt nun in einem kritischen Abschnitt und dauert nun länger, als die Waschmaschine zum Waschen braucht. Wird die Waschmaschine fertig, so wird das Wäschewaschen von der <code>lock</code>-Anweisung vor der Wäscheentnahme angehalten, bis Professor Hausmann seine Büroarbeit erledigt hat (→ <code>V11-Hausmann-3</code>).</p>
<h2 id="umsetzung-in-c-aufgaben-mit-rückgabeobjekten-und-explizites-starten-von-aufgaben">Umsetzung in C#: Aufgaben mit Rückgabeobjekten und explizites Starten von Aufgaben</h2>
<p>Nach erfolgreicher Hausarbeit wollen Professor Hausmann und seine Ehefrau getrennt einkaufen. Sobald beide zurück sind soll es Abendessen geben.</p>
<p>Technisch wird dies nach klassischem Muster der Threads realisiert: Die Aufgabe des Einkaufens ist eine gewöhnliche Methode, die direkt zum Methodenaufruf in einen eigenen Ablauffaden gelegt wird. Die Methode</p>
<pre><code class="language-C#"><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> <span class="hljs-title">AnzahlGekaufterWaren</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> name, <span class="hljs-built_in">int</span> anzahlBenötigterWaren</span>)
</span></div></code></pre>
<ul>
<li>hat als Parameter den Namen des Einkaufenden sowie die Anzahl benötigter Waren,</li>
<li>verbraucht in Abhängigkeit dieser Anzahl Zeit, und</li>
<li>liefert die Anzahl der tatsächlich gekauften Waren.</li>
</ul>
<p>Hier liegt also eine Aufgabe mit Rückgabeobjekt vor, von der zwei Instanzen parallel durchgeführt werden sollen. Dazu nutzen wir die generische Variante der Methode <code>Task.Run</code>, da die aufgerufene Methode <code>AnzahlGekaufterWaren</code> einen <code>int</code>-Wert als Rückgabe liefert:</p>
<pre><code class="language-C#"><div>        Task&lt;<span class="hljs-built_in">int</span>&gt; einkaufenHerrHausmann = Task.Run(() =&gt; AnzahlGekaufterWaren(<span class="hljs-string">&quot;Herr Hausmann&quot;</span>, <span class="hljs-number">3</span>));
        Task&lt;<span class="hljs-built_in">int</span>&gt; einkaufenFrauHausmann = Task.Run(() =&gt; AnzahlGekaufterWaren(<span class="hljs-string">&quot;Frau Hausmann&quot;</span>, <span class="hljs-number">5</span>));```
</div></code></pre>
<p>Nur die generische Klasse <code>Task</code> hat eine Eigenschaft</p>
<pre><code class="language-C#"><div><span class="hljs-keyword">public</span> TResult Result { <span class="hljs-keyword">get</span>; }
</div></code></pre>
<p>die nach Beendigung der Aufgabe das Ergebnis liefert, hier das der Methode <code>AnzahlGekaufterWaren</code> (→ <code>V11-Hausmann-4</code>):</p>
<pre><code class="language-C#"><div>        einkaufenHerrHausmann.Wait();
        einkaufenFrauHausmann.Wait();
        Console.WriteLine(<span class="hljs-string">$&quot;gekaufte Waren Herr Hausmann: <span class="hljs-subst">{einkaufenHerrHausmann.Result}</span>&quot;</span>);
        Console.WriteLine(<span class="hljs-string">$&quot;gekaufte Waren Frau Hausmann: <span class="hljs-subst">{einkaufenFrauHausmann.Result}</span>&quot;</span>);
</div></code></pre>
<h2 id="umsetzung-in-c-explizite-parallelität">Umsetzung in C#: Explizite Parallelität</h2>
<p>Jetzt soll es endlich Abendessen geben! Professor Hausmann kocht, seine Ehefrau deckt den Tisch.
Falls zwei gewöhnliche Methoden ohne Rückgabewert parallel ausgeführt werden sollen, so gibt es neben der Methode <code>Task.Run</code> noch eine weitere, kürzere Möglichkeit: Im Namensraum <code>System.Threading.Tasks</code> existiert die Klasse <code>Parallel</code> mit der Methode</p>
<pre><code class="language-C#"><div><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Invoke</span>(<span class="hljs-params"><span class="hljs-keyword">params</span> System.Action[] actions</span>)
</span></div></code></pre>
<p>die alle im Array <code>actions</code> angegebenen <code>void</code>-Methoden parallel ausführt (→ <code>V11-Hausmann-4</code>):</p>
<pre><code class="language-C#"><div>    Parallel.Invoke(() =&gt; Tätigkeit(<span class="hljs-string">&quot;Kochen (Herr Hausmann)&quot;</span>, <span class="hljs-number">3000</span>),
                    () =&gt; Tätigkeit(<span class="hljs-string">&quot;Tisch decken (Frau Hausmann)&quot;</span>, <span class="hljs-number">1000</span>));
</div></code></pre>
<h2 id="referenzen">Referenzen</h2>
<ul>
<li><a href="https://docs.microsoft.com/de-de/dotnet/csharp/async">Asynchrone Programmierung</a></li>
<li><a href="https://docs.microsoft.com/de-de/dotnet/api/system.threading.tasks?view=net-6.0">Namensraum <code>System.Threading.Tasks</code></a></li>
<li><a href="https://docs.microsoft.com/de-de/dotnet/api/system.threading.tasks.task?view=net-6.0">Klasse <code>Task</code></a></li>
<li><a href="https://docs.microsoft.com/de-de/dotnet/api/system.threading.tasks.task-1?view=net-6.0">Klasse <code>Task&lt;TResult&gt;</code></a></li>
<li><a href="https://docs.microsoft.com/de-de/dotnet/csharp/language-reference/keywords/async">Schlüsselwort <code>async</code></a></li>
<li><a href="https://docs.microsoft.com/de-de/dotnet/csharp/language-reference/operators/await">Operator <code>await</code></a></li>
<li><a href="https://docs.microsoft.com/de-de/dotnet/csharp/language-reference/statements/lock">Anweisung <code>lock</code></a></li>
<li><a href="https://docs.microsoft.com/de-de/dotnet/api/system.threading.tasks.parallel?view=net-6.0">Klasse <code>Parallel</code></a></li>
</ul>
<p>© Sven C. Martin, Hochschule Karlsruhe</p>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>Zur Erinnerung (im Namensraum <code>System</code>):<br>
<code>public delegate void Action();</code><br>
<code>public delegate TResult Func&lt;out TResult&gt;();</code> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn2" class="footnote-item"><p><code>await Task.Run(() =&gt; Tätigkeit(&quot;Waschen (Waschmaschine)&quot;, 10000));</code><br>
ist die Kurzform von:<br>
<code>Task t = Task.Run(() =&gt; Tätigkeit(&quot;Waschen (Waschmaschine)&quot;, 10000));</code><br>
<code>await t;</code><br>
Zwischen diesen beiden Anweisungen können auch noch beliebig viele andere liegen. Die Rückkehr zur rufenden Methode
kann also auch erst lange Zeit nach dem Abspalten der nebenläufigen Aufgabe geschehen. Sollte in dieser Zeit die
nebenläufige Aufgabe bereits erledigt worden sein, so geschieht bei <code>await</code> keine Rückkehr zur rufenden Methode,
sondern derselbe Ablauffaden arbeitet auch den Rest der Methode ab. <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn3" class="footnote-item"><p><code>WäscheWaschenAsync</code> ist eine asynchrone Methode. Als solche läuft sie von alleine im eigenen Ablauffaden und erzeugt automatisch ein Objekt der Klasse <code>Task</code>.
Ein Aufruf von <code>Task.Run</code> ist hier also nicht notwendig. <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>

        <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
        
    </body>
    </html>